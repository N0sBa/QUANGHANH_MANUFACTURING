
@{
    ViewData["Title"] = "Select";
    Layout = "~/Views/Shared/_Layout_TCLD.cshtml";
}
<link href="~/assets/libs/toastr/build/toastr.min.css" rel="stylesheet">
<style>

    #toast-container {
        min-width: 10%;
        top: 0;
        right: 50%;
        transform: translateX(50%) translateY(50%);
    }

    #export-button {
        float: right !important;
    }

    .current-data {
        color: #a7a7a7;
    }

    .totals {
        font-weight: bold;
        color: white;
        border-radius: 5px;
        padding: 2px 5px 2px 5px;
    }

    #totalrows {
        border: 1px solid red;
        background: red;
    }

    #total_selected {
        border: 1px solid green;
        background: green;
        cursor: pointer;
    }

        #total_selected:active {
            border: 1px solid #78c17e;
            background-color: #78c17e
        }

        #total_selected:hover {
            border: 1px solid #78c17e;
            background-color: #78c17e
        }

    .remove_select {
        color: red;
        font-size: 25px;
        cursor: pointer;
    }
</style>
<div class="row" id="chondieuchuyen">

    <div class="col m12">
        <div class="card">
            <div class="card-content wizard-content">
                <div>
                    <h3 class="center"><b>CHẤM DỨT HỢP ĐỒNG</b></h3>
                </div>
                <form action="#" class="validation-wizard wizard-circle m-t-40">
                    <!-- Step 1 -->
                    <h6>Chọn nhân viên</h6>
                    <section>
                        <div class="row" style="overflow-x:scroll  ;margin-bottom: 20px">
                            <div class="row center">
                                <div class="col l12 m12 s12 input-field">
                                    <input type="text" placeholder="Tìm kiếm theo mã nhân viên" class='form-control' id="searchMaNV" do-not-use-data-role="tagsinput" multiple autocomplete="off" />
                                </div>
                                <div class="col l12 m12 s12 input-field">
                                    <input type="text" placeholder="Tìm kiếm theo tên nhân viên" class='form-control' id="searchTenNV" multiple />
                                </div>
                                <div class="col l5 m12 s12 input-field">
                                    <select class="form-control" id="phongbanSearch">
                                        <option value="" selected>Phòng ban - Tất cả</option>
                                        @foreach (var phongban in ViewBag.listPhongBan)
                                        {
                                            <option value="@phongban.department_id">@phongban.department_name</option>
                                        }
                                    </select>
                                </div>
                                <div class="col l5 m12 s12 input-field">
                                    <select class="form-control" id="chucVuSearch">
                                        <option value="" selected>Chức vụ - Tất cả</option>
                                        @foreach (var cv in ViewBag.listCongViec)
                                        {
                                            <option value="@cv.work_id">@cv.name</option>
                                        }
                                    </select>
                                </div>
                                <div class="col l2 m12 s12 input-field">
                                    <button class="btn blue darken-2 btn-small waves-effect waves-light" id="searchButton">Tìm kiếm</button>
                                </div>

                            </div>
                            <div class="col l12 m12 s12 input-field">
                                <b> Đã chọn:</b>
                                <span class="totals modal-trigger" onclick="show_selected()" href="#show_select" id="total_selected">0</span>
                                <b> Tổng số:</b>
                                <span class="totals" id="totalrows"></span>
                            </div>
                            <br />
                            <table id="nhanVienTable" class="table striped table-responsive table-bordered">
                                <thead>
                                    <tr>
                                        <th>Số thẻ</th>
                                        <th>Họ và tên</th>
                                        <th>Ngày sinh</th>
                                        <th>Giới tính</th>
                                        <th>Phân xưởng hiện tại</th>
                                        <th>Chức vụ</th>
                                        <th>
                                            <label>
                                                <input type="checkbox" id="check-all" class="filled-in" />
                                                <span></span>
                                            </label>
                                        </th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </section>
                    <!-- Step 2 -->
                    <h6>Nhập thông tin chấm dứt</h6>
                    <section>
                        <div class="row">
                            <div class="center col s12 m12 l12">

                            </div>
                            <div class="col s12 m2 l2">
                                <input class="form-control" id="so-quyet-dinh" type="text" placeholder="Số quyết định" required autocomplete="off"/>
                            </div>
                            <div class="col s12 m5 l5">
                                <input id="ngay-quyet-dinh" class="thoigian center form-control" />
                            </div>
                            <div class="input-field col x12 s12 m12 l12">
                                <div class="table_container">
                                    <table class="striped table table-responsive table-bordered">
                                        <thead>
                                            <tr>
                                                <th>STT</th>
                                                <th>Mã nhân viên</th>
                                                <th>Họ và tên</th>
                                                <th>Đơn vị hiện tại</th>
                                                <th>Chức vụ hiện tại</th>
                                                <th id="lydo-header">
                                                    Lý do chấm dứt
                                                    <div class="select-all">
                                                        <label>
                                                            <input class="my_checkbox" id="check-select-all-bac" type="checkbox">
                                                            <span>Chọn cho tất cả</span>
                                                        </label>
                                                        <select id="select-dept-for-all" class="form-control" onchange="onSelectTypeOfEndContract2()" disabled>
                                                            @foreach (var item in ViewBag.terminate_type_html)
                                                            {
                                                                <option value='@item.termination_type_id'>@item.name</option>
                                                            }

                                                        </select>
                                                    </div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="selected-container">
                                        </tbody>
                                    </table>
                                    <div class="col m12">
                                        <div class=" div-center custom-divider"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <!-- Step 3 -->
                    <h6>Xác nhận chấm dứt</h6>
                    <section>
                        <div class="row" style="overflow-x:scroll; margin-bottom:10px;">
                            <h5>Số quyết định: <b id="maqd-preview"></b></h5>
                            <div class="row" style="margin-bottom:10px">
                                <div class="col l9 l9">
                                    <h5>Ngày quyết định: <b id="ngayqd-preview"></b></h5>
                                </div>
                                <div class="col l3 m3">
                                    <div class=" btn cyan left waves-effect waves-light" id="export-button">
                                        <i class="fas fa-file-word"></i><span> Xuất Quyết định</span>
                                    </div>
                                </div>
                            </div>
                            <table class="striped responsive-table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Số thứ tự</th>
                                        <th>Mã nhân viên</th>
                                        <th style="width: 200px">Họ và tên</th>
                                        <th style="width: 200px">Đơn vị hiện tại</th>
                                        <th style="width: 500px">Chức vụ hiện tại</th>
                                        @*<th style="width: 200px">Đơn vị điều động</th>
                                            <th style="width: 200px">Chức vụ điều động</th>
                                            <th style="width: 200px">Thang bậc lương</th>
                                            <th style="width: 200px">Phụ cấp</th>
                                            <th style="width: 200px">Bậc</th>
                                            <th style="width: 200px">Mức lương</th>*@
                                        <th style="width: 300px">Lý do chấm dứt</th>
                                    </tr>
                                </thead>
                                <tbody id="preview-table">
                                </tbody>
                            </table>
                        </div>

                    </section>
                    <!-- Step 4 -->
                    @*<h6>Hoàn thành</h6>
                        <section>
                            <div class="row">

                            </div>
                        </section>*@
                </form>
            </div>
        </div>

    </div>

</div>
<div id="show_select" class="modal">
    <div class="modal-content">
        <h4>Danh sách đã chọn</h4>
        <table class="striped responsive-table table-bordered">
            <thead>
                <tr>
                    <th>Số thứ tự</th>
                    <th>Số thẻ</th>
                    <th style="width: 200px">Họ và tên</th>
                    <th style="width: 200px">Giới tính</th>
                    <th style="width: 500px">Ngày sinh</th>
                    <th style="width: 200px">Phân xưởng hiện tại</th>
                    <th style="width: 200px">Chức vụ</th>
                    <th style="width: 200px">Bỏ chọn</th>
                </tr>
            </thead>
            <tbody id="show_select_table"></tbody>
        </table>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Đóng</a>
    </div>
</div>



<script src="~/js/Custom JS/TCLD/Transfer/Transfer_Select.js"></script>
<script src="~/js/Custom JS/Disable_input_material.js"></script>

<link href="~/dist/css/TABLE_BORDERED.css" rel="stylesheet" />
@section scripts{

    <script>
        $("#check-all").click(function () {
            alert("ahihi");
        })



    </script>

    <script>
        $("#pre-load").show("slow", function () {
         });
        $("#pre-load").css("z-index", "99999");
        var Popup, dataTable;
        @{
            var listFromServer = "[]";
            if (ViewBag.selectedList != null)
            {
                listFromServer = ViewBag.selectedList;
            }
         }
        var arrCarSelectedShow = [];
        var arrCarSelected = JSON.parse("@listFromServer");
        $(document).ready(function () {
            dataTable = $('#nhanVienTable')
                .on('preXhr.dt', function (e, settings, data) {
                    $("#pre-load").show("slow", function () {
                    });
                    $("#pre-load").css("z-index", "99999");


                })
                .DataTable({
                    "ajax": {
                        "url": "/phong-tcld/quan-ly-nhan-vien/danh-sach-cham-dut",
                        "type": "POST",
                        "datatype": "json",
                        "data": {
                            "MaNV": function () { return $('#searchMaNV').val() },
                            "TenNV": function () { return $('#searchTenNV').val() },
                            "ChucVu": function () { return $('#chucVuSearch').val() },
                            "PhongBan": function () { return $('#phongbanSearch').val() },
                        },
                        "dataSrc": function (receivedData) {
                            if (receivedData.data == "-1") {
                                errorAlert("Có lỗi", "Có lỗi xảy ra");
                                return receivedData.data;
                            } else {
                                $("#totalrows").text(receivedData.recordsTotal)
                                return receivedData.data;
                            }
                        },
                    },
                    "drawCallback": function (settings) {
                        $("#pre-load").hide("slow", function () {
                        });

                    },
                     "columns": [
                        {
                             "data": "employee_id", "name": "employee_id", "render": function (data) {
                                return "<a href='/phong-tcld/quan-ly-nhan-vien/xem-chi-tiet-nhan-vien?id=" + data + "' >" + data + "</a>"
                            },
                        },
                         { "data": "BASIC_INFO_full_name", "name": "BASIC_INFO_full_name" },
                        {
                            "data": "BASIC_INFO_date_of_birth", "name": "BASIC_INFO_date_of_birth", "render": function (data) {
                                return dateFormat(data);
                            }
                        },
                        {
                            "data": "BASIC_INFO_gender", "name": "BASIC_INFO_gender", "render": function (data) {
                                return genderFormat(data);
                            }
                        },
                         { "data": "department_name", "name": "department_name" },
                         { "data": "work", "name": "work" },
                       {
                           "data": "employee_id", "render": function (data, type, full) {
                               if (full.current_status_id === null) {
                                    return "";
                                } else {
                                   if (full.current_status_id != 1) {
                                       return "<i>" + full.StatusName +"</i>";
                                }
                                if (arrCarSelected != null) {
                                    for (let i = 0; i < arrCarSelected.length; i++)
                                        if (arrCarSelected[i] == data) {
                                            return "<label><input class='my_checkbox step1_checkbox'  name='abc' id ='" + data + "' value='" + data + "' type ='checkbox' onclick=updateList('" + data + "') checked><span></span></label>";
                                        }
                                }
                                return "<label><input class='my_checkbox step1_checkbox'  name='abc' id ='" + data + "' value='" + data + "' type ='checkbox' onclick=updateList('" + data + "')><span></span></label>";
                                }
                            },
                            "orderable": false,
                            "searchable": false,
                            "width": "150px"
                        }
                    ],
                    "serverSide": "true",
                    "order": [0, "asc"],
                    "searching": false,
                    "bLengthChange": false,
                    "autoWidth": false,
                    "bFilter": true,
                    "bInfo": false,
                    "language": {
                        emptyTable: "<li class='text-danger' align='center'>Không có dữ liệu</li>",
                        paginate:
                        {
                            previous: "Trang trước",
                            next: "Trang sau",
                            first: "|<",
                            last: ">|"
                        }
                    },
                    "pageLength": 15,
                    "initComplete": function (settings, json) {

                        $("#pre-load").hide("slow", function () {
                        });
                    },

                });
            $(".dataTables_paginate").css("float", "left");

            $("#searchButton").click(function () {
                dataTable.ajax.reload();
            });


        function dateFormat(d) {
            if (d == null) {
                return "";
            }
            var dateString = d.substr(6);
            var currentTime = new Date(parseInt(dateString));
            var month = currentTime.getMonth() + 1;
            var day = currentTime.getDate();
            var year = currentTime.getFullYear();
            var date = day + "/" + month + "/" + year;
            return (date);
            }

        function genderFormat(d) {
            if (d) {
                return "Nam";
            } else {
                return "Nữ";
            }
        }
            function changeState(value, state) {
                $.ajax({
                type: "POST",
                    url: "/sua-chua/save-session/",
                    data: {
                    id: JSON.stringify(value),
                        state: JSON.stringify(state)
                    },
                    dataType: "json",
                    success: function (data) {
                        alert("here" + data.d.toString());
                    }
                });
            }
        });
         function updateList(id) {
                isExist = false;
                for (let i = 0; i < arrCarSelected.length; i++) {
                    if (arrCarSelected[i] == id) {
                        isExist = true;
                        arrCarSelected.splice(i, 1);
                        for (let j = 0; j < arrCarSelectedShow.length; j++) {
                            if (arrCarSelectedShow[j].id == id) {
                                arrCarSelectedShow.splice(j,1);
                                break;
                            }
                        }
                        break;
                    }
                }
                if (!isExist && id != "" && id != null) {
                    arrCarSelected.push(id)
                    this_select = [];
                    $("#" + id).parent().parent().parent().find("td").each(function () {
                    this_select.push($(this).text());
                     });
            arrCarSelectedShow.push({
                "id": this_select[0],
                "name": this_select[1],
                "gender": this_select[2],
                "dob": this_select[3],
                "dept": this_select[4],
                "job": this_select[5],
            });
            }
            $("#total_selected").text(arrCarSelected.length);

            }
        function sendData() {
            $.each($("input[name='abc']:checked"), function () {
                });
            }
    </script>
    <script>
        //Custom design form example
        $(".tab-wizard").steps({
            headerTag: "h6",
            bodyTag: "section",
            transitionEffect: "fade",
            titleTemplate: '<span class="step">#index#</span> #title#',
            labels: {
                next: "Tiếp tục",
                previous: "Quay lại",
                finish: "Lưu"
            },
            onFinished: function (event, currentIndex) {
                swal("Form Submitted!", "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed lorem erat eleifend ex semper, lobortis purus sed.");

            }
        });


        var form = $(".validation-wizard").show();

        $(".validation-wizard").steps({
            headerTag: "h6",
            bodyTag: "section",
            transitionEffect: "fade",
            titleTemplate: '<span class="step">#index#</span> #title#',
            labels: {
                next: "Tiếp tục",
                previous: "Quay lại",
                finish: "Xác nhận"
            },
            onStepChanging: function (event, currentIndex, newIndex) {
                switch (newIndex) {
                    case 0:
                        if (currentIndex === 1) {
                            return confirm('Mọi thay đổi của bạn sẽ không được lưu lại?');
                        }
                        break;
                    case 1:
                        if (currentIndex === 0) {
                            if (arrCarSelected.length === 0) {
                                toastr.error('Hãy chọn ít nhất một nhân viên', '');
                                return false;
                            } else {
                                step2();
                                return true;
                            }
                        } else {
                            return true;
                        }
                        break;
                    case 2:
                        var a = validateThongTin();
                        if (a === true) {
                            step3();
                        }
                        return a;
                        break;
                }
            },
            onFinishing: function (event, currentIndex) {
                confirmAlert(
                    'Xác nhận tạo quyết định?',
                    'Có thể xem lại quyết định đã tạo trong các mục quyết định đã/chưa xử lý',
                    function ahihi() {
                        execute();
                    });
            },
            onFinished: function (event, currentIndex) {

            }
        }), $(".validation-wizard").validate({
            ignore: "input[type=hidden]",
            errorClass: "text-danger",
            successClass: "text-success",
            highlight: function (element, errorClass) {
                $(element).removeClass(errorClass)
            },
            unhighlight: function (element, errorClass) {
                $(element).removeClass(errorClass)
            },
            errorPlacement: function (error, element) {
                error.insertAfter(element)
            },
            rules: {
                email: {
                    email: !0
                }
            }
        })
    </script>
    <!------------------------------ WIZARD ------------------------------>
    <!------------------------------ STEP2 ------------------------------>
    <script>
        var cviecs = @Html.Raw(Json.Encode(ViewBag.listCongViec));
        var phongbans=@Html.Raw(Json.Encode(ViewBag.listPhongBan));
        //var doichieuluong=Html.Raw(Json.Encode(ViewBag.doichieuluong));
        var tagCV = "";
                        tagCV += "<option value='' disabled>Chọn chức vụ</option>\n";
                        for (var k = 0; k < cviecs.length; k++) {
                            tagCV += "<option value=\"" + cviecs[k].MaCongViec + "\">" + cviecs[k].TenCongViec + "</option>\n";
                        }
    </script>
    <script>
        function getThangLuongAndPhuCap(code, mcv) {
            var c = code;
            var m = mcv;
            $("#pre-load").show("slow", function () { });
            $.ajax({
                type: 'post',
                url: '/phong-tcld/dieu-chuyen/get-phu-cap-thang-luong',
                dataType: 'json',
                data: {
                    macv: m
                },
                success: function (r) {
                    if (r.success === true) {
                        $("#thang-" + c).val(r.data.MucThangLuong);
                        $("#thang-" + c).data('mathangluong', r.data.MaThangLuong);
                        $("#phucap-" + c).val(AddComma(r.data.PhuCap) == "null" ? "0" : AddComma(r.data.PhuCap));
                        var bacs = "";
                        $("#bac-" + c).empty();
                        for (var i = 0; i < r.bacs.length; i++) {
                            bacs += "<option data-mucluong=\"" + r.bacs[i].MucLuong + "\" value=\"" + r.bacs[i].MaBacLuong_ThangLuong_MucLuong + "\">" + r.bacs[i].MucBacLuong + "</option>";
                        }
                        $("#bac-" + c).append(bacs);
                        $("#luong-" + c).val(AddComma(r.bacs[0].MucLuong));

                        $("#bac-" + c).change(function () {
                            $("#luong-" + c).val(AddComma($(this).find(":selected").data("mucluong")));
                        });

                        $("#pre-load").hide("slow", function () { });
                    } else {

                    }
                }
            });
        }
    </script>
    <script>

        //check selected index:
        function step2() {
            $("#pre-load").show("slow", function () {
            });
            $.ajax({
                type: 'POST',
                url: '/phong-tcld/quan-ly-nhan-vien/danh-sach-cham-dut-step2',
                data: { 'selectedList': JSON.stringify(arrCarSelected) },
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        $("#so-quyet-dinh").empty();
                        $("#selected-container").empty();
                        var date = new Date();
                        $("#ngay-quyet-dinh").val(date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear());
                        var item_in_list = "";
                        for (i = 0; i < response.reason_list.length; i++) {
                            item_in_list += "<option value='" + response.reason_list[i].termination_type_id
                                + "'>" + response.reason_list[i].name + "</option> "
                        };
                        for (var i = 0; i < response.data.length; i++) {
                            var selectPhongBan = "";
                            selectPhongBan += "<option value='' disabled>Chọn phòng ban</option>\n";
                            $("#selected-container").append("<tr>\n");
                            $("#selected-container").append("<td>" + (i + 1) + "</td>\n");
                            $("#selected-container").append("<td>" + response.data[i].employee_id + "</td>\n");
                            $("#selected-container").append("<td id=\"hoten-" + response.data[i].employee_id + "\">" + response.data[i].BASIC_INFO_full_name + "</td>\n");
                            $("#selected-container").append("<td id=\"dvht-" + response.data[i].employee_id + "\">" + response.data[i].department_name + "</td>\n");
                            $("#selected-container").append("<td id=\"cvht-" + response.data[i].employee_id + "\">" + response.data[i].work + "</td>\n");
                            $("#selected-container").append("<td id=\"lydo-" + response.data[i].employee_id + "\">" +
                                "<select name='lydo' class='form-control lydo' id='tlhd-" + response.data[i].employee_id + "' onchange='onSelectTypeOfEndContract1(" + response.data[i].employee_id + ")'> "
                                + item_in_list +
                                "</select></td>\n ");
                            $("#selected-container").append(" </tr>\n");
                            /////////////////////////set combobox cong viec value/////////////////////////////
                            if (response.data[i].MaCongViec == null) {
                                $("#chucvu" + "-" + response.data[i].employee_id).val("");
                            } else {
                                $("#chucvu" + "-" + response.data[i].employee_id).val(response.data[i].MaCongViec);
                            }
                            /////////////////////////////////////
                            if (response.data[i].MaPhongBan == null) {
                                $("#donvi" + "-" + response.data[i].employee_id).val("");
                            } else {
                                $("#donvi" + "-" + response.data[i].employee_id).val(response.data[i].MaPhongBan);
                            }
                        }
                        //$(".date-chooser").removeClass("datepicker-here");
                        $(".form-control").each(function () {
                            $(this).attr('oninvalid', 'this.setCustomValidity(\"Please Enter valid email\")');
                            $(this).attr('oninput', 'setCustomValidity(\"\")');
                        });
                        //$(".date-chooser").datepicker({
                        //    language: 'vi',
                        //    range: true,
                        //    multipleDatesSeparator: '-'
                        //});
                        $(".date-chooser").data('datepicker');
                        ////////////////////////////////////////THANG LUONG///////////////

                        $(".chucvu").change(function () {

                            var mcv = $(this).find(":selected").val();
                            getThangLuongAndPhuCap($(this).attr("id").split('-')[1], mcv);
                            //$("#thang-" + $(this).attr("id").split('-')[1]).val("ahihi");
                        });
                        /////////////////////NGAY//////////////////////
                        $(".thoigian").keydown(function (e) {
                            e.preventDefault();
                        });
                        $("#pre-load").hide("slow", function () {
                        });
                        /////////////////////////////////////////////////////////////////////LUONG_DOI CHIEU/////////////////////////////////////////////////////////////
                        //$(".bac").keyup(function () {
                        //    ///////////////////////////
                        //    var thisId = $(this).attr('id').split('-')[1];
                        //    //////////////////////////
                        //    var BacLuongValue = $("#bac-" + thisId).val();
                        //    var ThangLuongValue = $("#thang-" + thisId).val();
                        //    for (var i = 0; i < doichieuluong.length; i++) {
                        //        if (BacLuongValue === doichieuluong[i].BacLuong
                        //            && ThangLuongValue === doichieuluong[i].ThangLuong) {
                        //            var thisLuong = AddComma(doichieuluong[i].MucLuong);
                        //            $("#luong-" + thisId).val(thisLuong);
                        //            break;
                        //        } else {
                        //            $("#luong-" + thisId).val("");
                        //        }
                        //    }
                        //});
                    } else {
                        errorAlert("Có lỗi", "Có lỗi xảy ra");
                        $("#pre-load").hide("slow", function () {
                        });
                    }
                },
            })
            if ($("#check-select-all-bac").prop("checked") == true) {
                $("#check-select-all-bac").click();
            }

        }
        //get list:
    </script>
    <script>
        $("#check-select-all-bac").change(function () {
            //alert('abc');
            if ($(this).prop("checked") == false) {
                $(".lydo").each(function () {
                    $(this).prop("disabled", false)
                    $("#select-dept-for-all").prop("disabled", true);
                });
            } else {
                $(".lydo").each(function () {
                    $(this).prop("disabled", true);
                    $(this).val($("#select-dept-for-all").val());
                    $("#select-dept-for-all").prop("disabled", false);
                });
            }
        });
        $("#select-dept-for-all").change(function () {
            $(".lydo").each(function () {
                $(this).val($("#select-dept-for-all").val());
            });
        });
    </script>

    <!------------------------------ VALIDATE STEP 2 ------------------------------>
    <script>
        //validate function:
        function validateThongTin() {
            var rs = true;
            if (rs !== false) {
                $("#pre-load").show("slow", function () {
                });
                $.ajax({
                    url: "/phong-tcld/quan-ly-nhan-vien/da-xu-ly-cham-dut/check-duplicate-sqd",
                    type: "post",
                    data: { SoQD: $("#so-quyet-dinh").val().trim() },
                    dataType: 'json',
                    success: function (response) {
                        if (response.success) {
                            if (response.data === true) {
                                rs = false;
                            }
                        }
                    },
                    async: false
                });
            }

            if (rs == false) {
                toastr.error('Mã Quyết định đã tồn tại', '');
                $("#pre-load").hide("slow", function () {
                });
                return rs;
            }

            if (rs !== false) {
                $(".numberInput").each(function () {
                    if ($(this).val() === "" || $(this).val() === null) {
                        toastr.error('Hãy nhập thông tin đầy đủ ', '');
                        rs = false;
                        $("#pre-load").hide("slow", function () {
                        });
                        return rs;
                    }
                });
            }
            if (rs !== false) {
                $(".thang").each(function () {
                    if ($(this).val() === "" || $(this).val() === null) {
                        toastr.error('Hãy nhập thông tin đầy đủ ', '');
                        rs = false;
                        $("#pre-load").hide("slow", function () {
                        });
                        return rs;
                    }
                });
            } if (rs !== false) {
                $(".bac").each(function () {
                    if ($(this).val() === "" || $(this).val() === null) {
                        toastr.error('Hãy nhập thông tin đầy đủ ', '');
                        rs = false;
                        $("#pre-load").hide("slow", function () {
                        });
                        return rs;
                    }
                });
            }
            if (rs !== false) {
                $(".donvi").each(function () {
                    if ($(this).val() === "" || $(this).val() === null) {
                        toastr.error('Hãy nhập thông tin đầy đủ ', '');
                        rs = false;
                        $("#pre-load").hide("slow", function () {
                        });
                        return rs;
                    }
                });
            }
            if (rs !== false) {
                $(".chucvu").each(function () {
                    if ($(this).val() === "" || $(this).val() === null) {
                        toastr.error('Hãy nhập thông tin đầy đủ ', '');
                        rs = false;
                        $("#pre-load").hide("slow", function () {
                        });
                        return rs;
                    }
                });
            }
            $("#pre-load").hide("slow", function () {
            });
            return rs;
        }
    </script>
    <!------------------------------ STEP 3 ------------------------------>
    <script>
        function step3() {
            //$("#pre-load").show("slow", function () {
            //});
            $("#maqd-preview").empty();
            $("#ngayqd-preview").empty();
            $("#maqd-preview").append($("#so-quyet-dinh").val().trim() === "" ? "Chưa có (lưu vào chờ xử lý)" : $("#so-quyet-dinh").val().trim());
            $("#ngayqd-preview").append($("#ngay-quyet-dinh").val());
            var selectedList = [];
            for (var i = 0; i < arrCarSelected.length; i++) {
                if ($("#check-select-all-bac").prop("checked") == false) {
                    if ($("#tlhd-" + arrCarSelected[i]).val().trim() == 'khac') {
                        var obj = {
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'termination_type_id': $("#khac" + arrCarSelected[i]).val(),
                            'termination_name': $("#khac" + arrCarSelected[i] + " option:selected").text()
                        }
                    } else {
                        var obj = {
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'termination_type_id': $("#tlhd-" + arrCarSelected[i]).val(),
                            'termination_name': $("#tlhd-" + arrCarSelected[i]+" option:selected").text()

                        }
                    }
                } else {
                    if ($("#select-dept-for-all").val().trim() == 'khac') {
                        var obj = {
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'termination_type_id': $("#khac-header").val(),
                            'termination_name': $("#khac-header option:selected").text()

                        }
                    } else {
                        var obj = {
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'termination_type_id': $("#select-dept-for-all").val(),
                            'termination_name': $("#select-dept-for-all option:selected").text()
                        }
                    }
                }
                selectedList.push(obj);
            }
            $("#preview-table").empty();
            for (var i = 0; i < selectedList.length; i++) {
                $("#preview-table").append("<tr>\n");
                $("#preview-table").append("<td>" + (i + 1) + "</td>\n");
                $("#preview-table").append("<td>" + selectedList[i].employee_id + "</td>\n");
                $("#preview-table").append("<td width=\"500px\">" + selectedList[i].BASIC_INFO_full_name + "</td>\n");
                $("#preview-table").append("<td>" + selectedList[i].department_name + "</td>\n");
                $("#preview-table").append("<td>" + selectedList[i].work + "</td>\n");
                $("#preview-table").append("<td>" + selectedList[i].termination_name.trim() + "</td>\n");
                $("#preview-table").append(" </tr>\n");
            }
        }
        function joinArr(res) {
            var r = "";
            for (var i = 0; i < res.length; i++) {
                r += res[i];
            }
            return r;
        }
    </script>
    <!------------------------------ CREATE QUYET DINH ------------------------------>
    <script>
        function execute() {
            $("#pre-load").show("slow", function () {
            });
            var selectedList = [];

            for (var i = 0; i < arrCarSelected.length; i++) {
                if ($("#check-select-all-bac").prop("checked") == false) {
                    if ($("#tlhd-" + arrCarSelected[i]).val().trim() == 'khac') {
                        var obj = {
                            'decision_number': $("#so-quyet-dinh").val().trim(),
                            'terminate_date': $("#ngay-quyet-dinh").val(),
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'reason': $("#khac" + arrCarSelected[i]).val().trim()
                        }
                    } else {
                        var obj = {
                            'decision_number': $("#so-quyet-dinh").val().trim(),
                            'terminate_date': $("#ngay-quyet-dinh").val(),
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'termination_type_id': $("#tlhd-" + arrCarSelected[i]).val().trim()
                        }
                    }
                } else {
                    if ($("#select-dept-for-all").val().trim() == 'khac') {
                        var obj = {
                            'decision_number': $("#so-quyet-dinh").val().trim(),
                            'terminate_date': $("#ngay-quyet-dinh").val(),
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'termination_type_id': $("#khac-header").val().trim()
                        }
                    } else {
                        var obj = {
                            'decision_number': $("#so-quyet-dinh").val().trim(),
                            'terminate_date': $("#ngay-quyet-dinh").val(),
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'termination_type_id': $("#select-dept-for-all").val().trim()
                        }
                    }
                }
                selectedList.push(obj);
            }
            $.ajax({
                type: 'post',
                url: '/delete',
                data: { selectedList: JSON.stringify(selectedList) },
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        $("#pre-load").hide("slow", function () {
                        });
                        reloadAlert('Tạo quyết định thành công', 3000);
                    } else {
                        $("#pre-load").hide("slow", function () {
                        });
                        errorAlert(response.message, '');
                    }
                }
            });
        }
    </script>
    <!------------------------------ VALIDATE FUNCTIONS ------------------------------>
    <script>
        function AddComma(Num) { //function to add commas to textboxes
            Num += '';
            Num = Num.replace('.', ''); Num = Num.replace('.', ''); Num = Num.replace('.', '');
            Num = Num.replace('.', ''); Num = Num.replace('.', ''); Num = Num.replace('.', '');
            x = Num.split(',');
            x1 = x[0];
            x2 = x.length > 1 ? ',' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1))
                x1 = x1.replace(rgx, '$1' + '.' + '$2');
            return x1 + x2;
        }
    </script>

    <!------------------------------ EXPORT HANDLER ------------------------------>
    <script>
        $("#export-button").click(function () {
            $("#pre-load").show("slow", function () {
            });
            var selectedList = [];
            for (var i = 0; i < arrCarSelected.length; i++) {
                if ($("#check-select-all-bac").prop("checked") == false) {
                    if ($("#tlhd-" + arrCarSelected[i]).val().trim() == 'khac') {
                        var obj = {
                            'decision_number': $("#so-quyet-dinh").val().trim(),
                            'terminate_date': $("#ngay-quyet-dinh").val(),
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'reason': $("#khac" + arrCarSelected[i]).val().trim()
                        }
                    } else {
                        var obj = {
                            'decision_number': $("#so-quyet-dinh").val().trim(),
                            'terminate_date': $("#ngay-quyet-dinh").val(),
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'termination_type_id': $("#tlhd-" + arrCarSelected[i]).val().trim()
                        }
                    }
                } else {
                    if ($("#select-dept-for-all").val().trim() == 'khac') {
                        var obj = {
                            'decision_number': $("#so-quyet-dinh").val().trim(),
                            'terminate_date': $("#ngay-quyet-dinh").val(),
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'termination_type_id': $("#khac-header").val().trim()
                        }
                    } else {
                        var obj = {
                            'decision_number': $("#so-quyet-dinh").val().trim(),
                            'terminate_date': $("#ngay-quyet-dinh").val(),
                            'employee_id': arrCarSelected[i],
                            'BASIC_INFO_full_name': $("#hoten-" + arrCarSelected[i]).text(),
                            'department_name': $("#dvht-" + arrCarSelected[i]).text(),
                            'work': $("#cvht-" + arrCarSelected[i]).text(),
                            'decision_date': $("#ngay-quyet-dinh").val(),
                            'termination_type_id': $("#select-dept-for-all").val().trim()
                        }
                    }
                }
                selectedList.push(obj);
            }
            $.ajax({
                type: 'Post',
                url: '/phong-tcld/quan-ly-nhan-vien/cham-dut/export-quyet-dinh',
                data: { selectedList: JSON.stringify(selectedList) },
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        window.location.href = response.location;
                        $("#pre-load").hide("slow", function () {
                        });

                    } else {
                        alert("error");
                    }
                }
            });

        });
    </script>
    <script>
        $("#ngay-quyet-dinh").datepicker({
            toggleSelected: false,
            language: 'vi'
        });
    </script>
    <script>
        $(function () {
            $(".datepicker-inline").remove();
        })
    </script>
    <script src="~/assets/libs/toastr/build/toastr.min.js"></script>
    <script src="~/assets/extra-libs/toastr/toastr-init.js"></script>
    <script src="~/js/Custom JS/TCLD/Brief/Briefs_List.js"></script>
    <script>
        $("#check-all").change(function () {
            if ($(this).prop("checked") == false) {
                $(".step1_checkbox").each(function () {
                    if ($(this).prop("checked") == true) {
                        $(this).click();
                    }
                });
            } else {
                $(".step1_checkbox").each(function () {
                    if ($(this).prop("checked") == false) {
                        $(this).click();
                    }
                });
            }

        });



    </script>
    <script>
        function show_selected() {
            $("#show_select_table").empty();
            for (let i = 0; i < arrCarSelectedShow.length; i++) {
                $("#show_select_table").append("<tr>");
                $("#show_select_table").append("<td>" + (i + 1) + "</td>");
                $("#show_select_table").append("<td>" + arrCarSelectedShow[i].id + "</td>");
                $("#show_select_table").append("<td>" + arrCarSelectedShow[i].name + "</td>");
                $("#show_select_table").append("<td>" + arrCarSelectedShow[i].gender + "</td>");
                $("#show_select_table").append("<td>" + arrCarSelectedShow[i].dob + "</td>");
                $("#show_select_table").append("<td>" + arrCarSelectedShow[i].dept + "</td>");
                $("#show_select_table").append("<td>" + arrCarSelectedShow[i].job + "</td>");
                $("#show_select_table").append("<td><i onclick=\"remove_from_selected(" + arrCarSelectedShow[i].id + ")\" class=\"remove_select material-icons dp48\">cancel</i></td>");
                $("#show_select_table").append("</tr>");
            }
        }
        function remove_from_selected(id) {
            for (i in arrCarSelected) {
                if (arrCarSelected[i] == id) {
                    arrCarSelected.splice(i, 1);
                    break;
                }
            }
            for (j in arrCarSelectedShow) {
                if (arrCarSelectedShow[j].id == id) {
                    arrCarSelectedShow.splice(j, 1);
                    break;
                }
            }
            $("#" + id).prop("checked", false);
            $("#total_selected").text(arrCarSelected.length);
            show_selected()
        }
    </script>
}  <!-- This page plugin js -->
<!-- ============================================================== -->
